<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Qur'oniy Zukkolik | Professional Hifz Tizimi</title>
    <meta name="description" content="Jiddiy o'rganuvchilar uchun Oliy darajadagi Qur'on test platformasi.">
    <meta name="author" content="Muhammad Daler">

    <!-- FONTS: 'Outfit' (Zamonaviy O'zbekcha) va 'Amiri' (Qur'oniy Arabcha) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* * -----------------------------------------------------------
         * 1. DIZAYN TIZIMI (DESIGN SYSTEM) - ISLAMIC MINIMAL
         * -----------------------------------------------------------
         */
        :root {
            /* Ranglar Palitrasi */
            --color-primary: #064e3b;       /* To'q Zumrad (Emerald 900) */
            --color-primary-light: #10b981; /* Yorqin Zumrad */
            --color-gold: #d97706;          /* Oltin (Amber 600) */
            --color-gold-light: #fcd34d;    /* Ochiq Oltin */
            --color-bg: #f8fafc;            /* Ochiq Fon */
            --color-surface: #ffffff;       /* Kartalar foni */
            --color-text: #1e293b;          /* Asosiy Matn */
            --color-text-muted: #64748b;    /* Yordamchi Matn */
            --color-error: #ef4444;
            --color-success: #059669;

            /* O'lchamlar va Radius */
            --radius-sm: 8px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --shadow: 0 10px 40px -10px rgba(0,0,0,0.08);

            /* Shriftlar */
            --font-uz: 'Outfit', sans-serif;
            --font-ar: 'Amiri', serif;
        }

        /* Dark Mode (Avtomatik yoki qo'lda) */
        [data-theme="dark"] {
            --color-bg: #0f172a;
            --color-surface: #1e293b;
            --color-text: #f1f5f9;
            --color-text-muted: #94a3b8;
            --color-primary: #34d399;
            --color-primary-light: #6ee7b7;
        }

        /* -----------------------------------------------------------
         * 2. RESET & GLOBAL STYLES
         * -----------------------------------------------------------
         */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: var(--font-uz);
            background-color: var(--color-bg);
            color: var(--color-text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--color-text-muted); border-radius: 10px; }

        /* Container */
        .app-shell {
            width: 100%;
            max-width: 600px; /* Mobile-first optimal width */
            margin: 0 auto;
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* -----------------------------------------------------------
         * 3. UI KOMPONENTLARI
         * -----------------------------------------------------------
         */
        
        /* Tugmalar */
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn:active { transform: scale(0.98); }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary), #047857);
            color: white;
            box-shadow: 0 4px 15px rgba(6, 78, 59, 0.3);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--color-text-muted);
            color: var(--color-text);
        }
        
        .btn-gold {
            background: linear-gradient(135deg, var(--color-gold), #b45309);
            color: white;
        }

        /* Kartalar va Panellar */
        .card {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            padding: 30px 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.05);
            margin-bottom: 20px;
            animation: slideUp 0.4s ease-out;
        }

        /* Navigatsiya Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0 25px;
        }
        .brand { font-weight: 800; font-size: 1.4rem; color: var(--color-primary); display: flex; align-items: center; gap: 8px; }
        .brand span { color: var(--color-gold); font-size: 1.8rem; }

        /* Arabic Text Display */
        .ayah-display {
            font-family: var(--font-ar);
            font-size: 2rem;
            line-height: 2.4;
            text-align: center;
            color: var(--color-text);
            margin: 25px 0;
            direction: rtl;
            position: relative;
            padding: 20px;
            background-image: radial-gradient(circle at center, rgba(6, 78, 59, 0.05) 0%, transparent 70%);
            border-radius: var(--radius-md);
        }

        /* Options Grid */
        .options-list { display: flex; flex-direction: column; gap: 12px; }
        
        .option-item {
            background: var(--color-bg);
            padding: 18px;
            border-radius: var(--radius-md);
            border: 2px solid transparent;
            cursor: pointer;
            text-align: right;
            direction: rtl;
            font-family: var(--font-ar);
            font-size: 1.4rem;
            transition: 0.2s;
            color: var(--color-text);
            position: relative;
            overflow: hidden;
        }
        
        .option-item:hover { border-color: var(--color-primary-light); background: rgba(16, 185, 129, 0.05); }
        .option-item.correct { background: #dcfce7; border-color: #16a34a; color: #14532d; }
        .option-item.wrong { background: #fee2e2; border-color: #dc2626; color: #7f1d1d; }

        /* Hikmat Box */
        .hikmat-container {
            margin-top: 25px;
            padding: 20px;
            background: rgba(217, 119, 6, 0.1);
            border-right: 4px solid var(--color-gold);
            border-radius: var(--radius-sm);
            display: none;
            animation: fadeIn 0.5s;
        }
        .hikmat-title { color: var(--color-gold); font-weight: 800; font-size: 0.8rem; text-transform: uppercase; display: block; margin-bottom: 5px; }
        .hikmat-text { font-style: italic; font-weight: 500; line-height: 1.6; }

        /* Juz Grid */
        .juz-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .juz-box {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--color-bg);
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: 0.2s;
            border: 2px solid transparent;
        }
        .juz-box:hover { border-color: var(--color-primary); color: var(--color-primary); }
        .juz-box.active { background: var(--color-primary); color: white; border-color: var(--color-primary); }

        /* Footer */
        footer {
            margin-top: auto;
            text-align: center;
            padding: 20px;
            font-size: 0.8rem;
            color: var(--color-text-muted);
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mt-20 { margin-top: 20px; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Responsive Fixes */
        @media (max-width: 400px) {
            .juz-grid { grid-template-columns: repeat(4, 1fr); }
            .ayah-display { font-size: 1.6rem; }
        }
    </style>
</head>
<body data-theme="light">

    <div class="app-shell">
        
        <!-- HEADER -->
        <header>
            <div class="brand">
                <span>€û</span> QUR'ONIY
            </div>
            <button class="btn-outline" style="width: auto; padding: 8px 12px; border-radius: 50%;" onclick="App.toggleTheme()">
                üåô
            </button>
        </header>

        <!-- 1. HOME PAGE -->
        <section id="page-home" class="card active">
            <div class="text-center">
                <h1 style="font-size: 2rem; color: var(--color-primary); margin-bottom: 10px;">Xush Kelibsiz</h1>
                <p style="color: var(--color-text-muted); margin-bottom: 25px;">
                    Jiddiy tolibi ilmlar uchun Qur'on hifzini mustahkamlash platformasi.
                </p>
                
                <div style="background: var(--color-bg); padding: 15px; border-radius: var(--radius-md); margin-bottom: 25px;">
                    <span style="font-size: 0.9rem; text-transform: uppercase; color: var(--color-text-muted);">Sizning Rekordingiz</span>
                    <div style="font-size: 2.5rem; font-weight: 800; color: var(--color-gold);" id="display-highscore">0%</div>
                </div>

                <button class="btn btn-primary" onclick="App.navigate('selection')">
                    IMTIHONNI BOSHLASH
                </button>
                <button class="btn btn-outline mt-20" onclick="App.navigate('advice')">
                    Tavsiya va Maslahatlar
                </button>
            </div>
        </section>

        <!-- 2. SELECTION PAGE -->
        <section id="page-selection" class="card hidden">
            <h2 class="text-center" style="color: var(--color-primary);">Imtihon Sozlamalari</h2>
            
            <div class="mt-20">
                <label style="font-weight: 600; font-size: 0.9rem;">1. Qiyinchilik Darajasi</label>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button class="btn btn-outline" id="diff-easy" onclick="App.setDifficulty('easy')">Oson</button>
                    <button class="btn btn-outline" id="diff-medium" onclick="App.setDifficulty('medium')">O'rta</button>
                    <button class="btn btn-outline" id="diff-hard" onclick="App.setDifficulty('hard')">Qiyin</button>
                </div>
            </div>

            <div class="mt-20">
                <label style="font-weight: 600; font-size: 0.9rem;">2. Manba Tanlovi</label>
                <button class="btn btn-gold mt-20" onclick="App.startFullTest()">BUTUN QUR'ON (Aralash)</button>
                
                <p style="text-align: center; margin: 15px 0; font-size: 0.8rem; opacity: 0.7;">‚Äî YOKI JUZ TANLANG ‚Äî</p>
                
                <div class="juz-grid" id="juz-container">
                    <!-- JS fills this -->
                </div>
            </div>

            <button class="btn btn-outline mt-20" onclick="App.navigate('home')">‚Üê Ortga Qaytish</button>
        </section>

        <!-- 3. QUIZ PAGE (CORE) -->
        <section id="page-quiz" class="card hidden">
            <!-- Progress Bar -->
            <div style="height: 6px; background: var(--color-bg); border-radius: 10px; overflow: hidden; margin-bottom: 15px;">
                <div id="quiz-progress" style="height: 100%; width: 0%; background: var(--color-primary); transition: width 0.3s;"></div>
            </div>
            
            <div style="display: flex; justify-content: space-between; font-size: 0.85rem; font-weight: 600; color: var(--color-text-muted);">
                <span id="quiz-counter">1 / 10</span>
                <span id="quiz-mode-label">JUZ 30 ‚Ä¢ QIYIN</span>
            </div>

            <h3 id="question-text" class="text-center mt-20" style="font-weight: 600;">Savol matni yuklanmoqda...</h3>
            
            <div id="ayah-box" class="ayah-display">
                <!-- Arabic Ayah -->
            </div>

            <div id="options-box" class="options-list">
                <!-- Options -->
            </div>

            <!-- Hikmat (Feedback) -->
            <div id="hikmat-panel" class="hikmat-container">
                <span class="hikmat-title">üåü Qur'oniy Hikmat</span>
                <p id="hikmat-content" class="hikmat-text"></p>
            </div>

            <div class="mt-20" style="display: flex; gap: 10px;">
                <button class="btn btn-outline" style="flex: 1; border-color: var(--color-error); color: var(--color-error);" onclick="App.navigate('home')">Chiqish</button>
                <button id="btn-next" class="btn btn-primary hidden" style="flex: 2;" onclick="App.nextQuestion()">Keyingi ‚Üí</button>
            </div>
        </section>

        <!-- 4. RESULTS PAGE -->
        <section id="page-result" class="card hidden text-center">
            <h2 style="color: var(--color-primary);">Natija</h2>
            
            <div style="width: 150px; height: 150px; border-radius: 50%; border: 8px solid var(--color-primary); display: flex; align-items: center; justify-content: center; margin: 30px auto; font-size: 3rem; font-weight: 800; color: var(--color-primary);">
                <span id="res-score">0%</span>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                <div style="background: #dcfce7; padding: 15px; border-radius: 12px; color: #14532d;">
                    ‚úÖ To'g'ri: <strong id="res-correct">0</strong>
                </div>
                <div style="background: #fee2e2; padding: 15px; border-radius: 12px; color: #7f1d1d;">
                    ‚ùå Xato: <strong id="res-wrong">0</strong>
                </div>
            </div>

            <p id="res-msg" style="margin-bottom: 25px; font-weight: 600; line-height: 1.5;">...</p>

            <button class="btn btn-primary" onclick="App.navigate('selection')">Qayta Urinish</button>
            <button class="btn btn-outline mt-20" onclick="App.navigate('home')">Bosh Sahifa</button>
        </section>

        <!-- 5. ADVICE PAGE -->
        <section id="page-advice" class="card hidden">
            <h2 style="color: var(--color-primary); margin-bottom: 20px;">Foydali Tavsiyalar</h2>
            <ul style="padding-left: 20px; line-height: 1.8; color: var(--color-text);">
                <li style="margin-bottom: 10px;"><strong>Ixlos:</strong> Qur'onni faqat Alloh roziligi uchun yodlang.</li>
                <li style="margin-bottom: 10px;"><strong>Mutashabihlar:</strong> O'xshash oyatlarni (mutashabih) alohida daftarga yozib, farqlarini belgilang. Bu test aynan shularni mustahkamlashga yordam beradi.</li>
                <li style="margin-bottom: 10px;"><strong>Tartil:</strong> Shoshilmang. Tez o'qish xatoga olib keladi.</li>
                <li style="margin-bottom: 10px;"><strong>Takror:</strong> "Inson unutuvchidir". Kunlik takror ‚Äî hifzning yuragi.</li>
            </ul>
            <button class="btn btn-outline mt-20" onclick="App.navigate('home')">Tushunarli</button>
        </section>

    </div>

    <footer>
        ¬© Muhammad Daler tomonidan ishlab chiqarilgan <br>
        <span style="opacity: 0.6; font-size: 0.7rem;">Ultra Smart Quran Test v4.0 (Stable)</span>
    </footer>

    <!-- 
     * -----------------------------------------------------------
     * 4. LOGIKA VA MA'LUMOTLAR BAZASI (JAVASCRIPT)
     * -----------------------------------------------------------
    -->
    <script>
        // QUR'ON MA'LUMOTLAR BAZASI (NAMUNA)
        // Haqiqiy loyihada bu yerda minglab savollar JSON formatida bo'ladi.
        // Hozirgi kodda 30-Juz va muhim suralardan "High IQ" savollar kiritilgan.
        const QUESTION_DB = [
            // --- JUZ 30 (AMMA) ---
            { juz: 30, level: 'easy', type: 'complete', q: "An-Naba surasi, 2-oyatni davom ettiring:", a: "ÿπŸéŸÖŸéŸë ŸäŸéÿ™Ÿéÿ≥Ÿéÿ¢ÿ°ŸéŸÑŸèŸàŸÜŸé", opts: ["ÿπŸéŸÜŸê Ÿ±ŸÑŸÜŸéŸëÿ®Ÿéÿ•Ÿê Ÿ±ŸÑ€°ÿπŸéÿ∏ŸêŸäŸÖŸê", "ŸÉŸéŸÑŸéŸëÿß ÿ≥ŸéŸäŸéÿπ€°ŸÑŸéŸÖŸèŸàŸÜŸé", "ÿ£ŸéŸÑŸéŸÖ€° ŸÜŸéÿ¨€°ÿπŸéŸÑŸê Ÿ±ŸÑ€°ÿ£Ÿéÿ±€°ÿ∂Ÿé ŸÖŸêŸáŸéŸ∞ÿØŸóÿß"], c: 0 },
            { juz: 30, level: 'hard', type: 'before', q: "Naziyat surasining ushbu oyatidan OLDIN nima kelgan?", a: "ŸÅŸéÿ•Ÿêÿ∞Ÿéÿß ÿ¨Ÿéÿ¢ÿ°Ÿéÿ™Ÿê Ÿ±ŸÑÿ∑ŸéŸëÿ¢ŸÖŸéŸëÿ©Ÿè Ÿ±ŸÑ€°ŸÉŸèÿ®€°ÿ±ŸéŸâŸ∞", opts: ["ŸÖŸéÿ™ŸéŸ∞ÿπŸóÿß ŸÑŸéŸëŸÉŸèŸÖ€° ŸàŸéŸÑŸêÿ£ŸéŸÜ€°ÿπŸéŸ∞ŸÖŸêŸÉŸèŸÖ€°", "ŸäŸéŸà€°ŸÖŸé ŸäŸéÿ™Ÿéÿ∞ŸéŸÉŸéŸëÿ±Ÿè Ÿ±ŸÑ€°ÿ•ŸêŸÜÿ≥ŸéŸ∞ŸÜŸè ŸÖŸéÿß ÿ≥ŸéÿπŸéŸâŸ∞", "ŸàŸéÿ£ŸéŸÖŸéŸëÿß ŸÖŸéŸÜ ÿÆŸéÿßŸÅŸé ŸÖŸéŸÇŸéÿßŸÖŸé ÿ±Ÿéÿ®ŸêŸëŸáŸê€¶"], c: 0 }, // Javob: Mata'an lakum (33 -> 34)
            { juz: 30, level: 'medium', type: 'complete', q: "Abasa surasi: 'Inson o'z taomiga boqsin...'", a: "ŸÅŸéŸÑ€°ŸäŸéŸÜÿ∏Ÿèÿ±Ÿê Ÿ±ŸÑ€°ÿ•ŸêŸÜÿ≥ŸéŸ∞ŸÜŸè ÿ•ŸêŸÑŸéŸâŸ∞ ÿ∑ŸéÿπŸéÿßŸÖŸêŸáŸê€¶Ÿì", opts: ["ÿ£ŸéŸÜŸéŸëÿß ÿµŸéÿ®Ÿéÿ®€°ŸÜŸéÿß Ÿ±ŸÑ€°ŸÖŸéÿ¢ÿ°Ÿé ÿµŸéÿ®ŸëŸóÿß", "ÿ´ŸèŸÖŸéŸë ÿ¥ŸéŸÇŸéŸÇ€°ŸÜŸéÿß Ÿ±ŸÑ€°ÿ£Ÿéÿ±€°ÿ∂Ÿé ÿ¥ŸéŸÇŸëŸóÿß", "ŸÅŸéÿ£ŸéŸÜ€¢ÿ®Ÿéÿ™€°ŸÜŸéÿß ŸÅŸêŸäŸáŸéÿß ÿ≠Ÿéÿ®ŸëŸóÿß"], c: 0 },
            { juz: 30, level: 'easy', type: 'complete', q: "Infitor surasi 6-oyat: 'Ey Inson...'", a: "ŸäŸéŸ∞Ÿìÿ£ŸéŸäŸèŸëŸáŸéÿß Ÿ±ŸÑ€°ÿ•ŸêŸÜÿ≥ŸéŸ∞ŸÜŸè ŸÖŸéÿß ÿ∫Ÿéÿ±ŸéŸëŸÉŸé", opts: ["ÿ®Ÿêÿ±Ÿéÿ®ŸêŸëŸÉŸé Ÿ±ŸÑ€°ŸÉŸéÿ±ŸêŸäŸÖŸê", "ÿ®Ÿêÿ±Ÿéÿ®ŸêŸëŸÉŸé Ÿ±ŸÑ€°ÿπŸéÿ∏ŸêŸäŸÖŸê", "ÿ®Ÿêÿ±Ÿéÿ®ŸêŸëŸÉŸé Ÿ±ŸÑ€°ÿ±Ÿéÿ≠ŸêŸäŸÖŸê"], c: 0 },
            { juz: 30, level: 'hard', type: 'iq', q: "Qaysi sura 'Vayl' (Voy bo'lsin) so'zi bilan boshlanadi?", a: "Surani tanlang:", opts: ["Al-Humaza", "At-Takasur", "Al-Qoria"], c: 0 },

            // --- JUZ 29 (TABARAK) ---
            { juz: 29, level: 'medium', type: 'complete', q: "Mulk surasi: 'O'lim va hayotni yaratgan zot...'", a: "Ÿ±ŸÑŸéŸëÿ∞ŸêŸä ÿÆŸéŸÑŸéŸÇŸé Ÿ±ŸÑ€°ŸÖŸéŸà€°ÿ™Ÿé ŸàŸéŸ±ŸÑ€°ÿ≠ŸéŸäŸéŸàŸ∞ÿ©Ÿé ŸÑŸêŸäŸéÿ®€°ŸÑŸèŸàŸéŸÉŸèŸÖ€°", opts: ["ÿ£ŸéŸäŸèŸëŸÉŸèŸÖ€° ÿ£Ÿéÿ≠€°ÿ≥ŸéŸÜŸè ÿπŸéŸÖŸéŸÑŸóÿß", "ÿ£ŸéŸäŸèŸëŸÉŸèŸÖ€° ÿ£ŸéŸÉŸíÿ´Ÿéÿ±Ÿè ŸÖŸéÿßŸÑÿßŸã", "ÿ£ŸéŸäŸèŸëŸÉŸèŸÖ€° ÿ£ŸéŸÇŸíŸàŸéŸâŸ∞ ÿ•ŸêŸäŸÖŸéÿßŸÜŸãÿß"], c: 0 },
            { juz: 29, level: 'hard', type: 'context', q: "Qalam surasi (68:4): Payg'ambarimiz (s.a.v) nima bilan sifatlanganlar?", a: "ŸàŸéÿ•ŸêŸÜŸéŸëŸÉŸé ŸÑŸéÿπŸéŸÑŸéŸâŸ∞", opts: ["ÿÆŸèŸÑŸèŸÇŸç ÿπŸéÿ∏ŸêŸäŸÖŸñ", "ŸáŸèÿØŸãŸâ ŸÖŸèŸëÿ≥Ÿíÿ™ŸéŸÇŸêŸäŸÖŸç", "ŸÜŸèŸàÿ±Ÿç ŸÖŸèŸëÿ®ŸêŸäŸÜŸç"], c: 0 },
            
            // --- JUZ 1 (ALIF LAM MIM) ---
            { juz: 1, level: 'medium', type: 'complete', q: "Baqara surasi 152-oyat: 'Meni eslanglar...'", a: "ŸÅŸéŸ±ÿ∞€°ŸÉŸèÿ±ŸèŸàŸÜŸêŸäŸì ÿ£Ÿéÿ∞€°ŸÉŸèÿ±€°ŸÉŸèŸÖ€° ŸàŸéŸ±ÿ¥€°ŸÉŸèÿ±ŸèŸàÿßŸí ŸÑŸêŸä", opts: ["ŸàŸéŸÑŸéÿß ÿ™ŸéŸÉ€°ŸÅŸèÿ±ŸèŸàŸÜŸê", "ŸàŸéŸÑŸéÿß ÿ™Ÿèÿ≥€°ÿ±ŸêŸÅŸèŸàÿß", "ŸàŸéŸÑŸéÿß ÿ™ŸéÿπŸíÿ™ŸéÿØŸèŸàÿß"], c: 0 },
            { juz: 1, level: 'hard', type: 'iq', q: "Baqara surasidagi eng uzun oyat qaysi mavzuda?", a: "Oyat mavzusini toping:", opts: ["Qarz oldi-berdisi", "Ribo (Sudxo'rlik)", "Taloq", "Haj"], c: 0 },

            // --- JUZ 2-28 (ARALASH - SYSTEM LOGIC UCHUN) ---
            { juz: 18, level: 'medium', type: 'complete', q: "Kahf surasi boshi:", a: "Ÿ±ŸÑ€°ÿ≠ŸéŸÖ€°ÿØŸè ŸÑŸêŸÑŸéŸëŸáŸê Ÿ±ŸÑŸéŸëÿ∞ŸêŸäŸì ÿ£ŸéŸÜÿ≤ŸéŸÑŸé ÿπŸéŸÑŸéŸâŸ∞ ÿπŸéÿ®€°ÿØŸêŸáŸê Ÿ±ŸÑ€°ŸÉŸêÿ™ŸéŸ∞ÿ®Ÿé", opts: ["ŸàŸéŸÑŸéŸÖ€° ŸäŸéÿ¨€°ÿπŸéŸÑ ŸÑŸéŸëŸáŸè€• ÿπŸêŸàŸéÿ¨Ÿéÿß€ú", "ŸÇŸéŸäŸêŸëŸÖŸóÿß ŸÑŸêŸëŸäŸèŸÜÿ∞Ÿêÿ±Ÿé ÿ®Ÿéÿ£€°ÿ≥Ÿóÿß", "ŸÑŸêŸëŸäŸèŸÜÿ∞Ÿêÿ±Ÿé ÿ®Ÿéÿ£Ÿíÿ≥Ÿãÿß ÿ¥ŸéÿØŸêŸäÿØŸãÿß"], c: 0 },
            { juz: 27, level: 'medium', type: 'iq', q: "Ar-Rahmon surasida 'Robbingizning qaysi ne'matlarini yolg'on deya olasiz?' oyati necha marta takrorlangan?", a: "ŸÅŸéÿ®Ÿêÿ£ŸéŸäŸêŸë ÿ°ŸéÿßŸÑŸéÿ¢ÿ°Ÿê ÿ±Ÿéÿ®ŸêŸëŸÉŸèŸÖŸéÿß ÿ™ŸèŸÉŸéÿ∞ŸêŸëÿ®ŸéÿßŸÜŸê", opts: ["31 marta", "28 marta", "33 marta"], c: 0 },
            { juz: 23, level: 'easy', type: 'complete', q: "Yasin surasi 2-oyat:", a: "ŸàŸéŸ±ŸÑ€°ŸÇŸèÿ±€°ÿ°ŸéÿßŸÜŸê", opts: ["Ÿ±ŸÑ€°ÿ≠ŸéŸÉŸêŸäŸÖŸê", "Ÿ±ŸÑ€°ŸÉŸéÿ±ŸêŸäŸÖŸê", "Ÿ±ŸÑ€°ŸÖŸéÿ¨ŸêŸäÿØŸê", "Ÿ±ŸÑ€°ÿπŸéÿ∏ŸêŸäŸÖŸê"], c: 0 }
        ];

        const HIKMATLAR = [
            "Qur'on o'qilgan xonadon ‚Äî nurga to'lgan xonadondir.",
            "Ilm oling, zero ilm saodat kalitidir.",
            "Sabr qiling, albatta Alloh sabrlilar bilan.",
            "Qur'on sizning yo foydangizga, yoki zararingizga hujjatdir.",
            "Eng yaxshingiz ‚Äì Qur'onni o'rganib, o'rgatganingizdir.",
            "Hifzni saqlash ‚Äì uni yodlashdan qiyinroqdir.",
            "Tilingizni Allohning zikri bilan namlab turing.",
            "Gunohlar hifzni unuttiradi. Istig'forni ko'paytiring."
        ];

        // --- GLOBAL APP CONTROLLER ---
        window.App = {
            state: {
                difficulty: 'medium',
                questions: [],
                currentIndex: 0,
                score: 0,
                total: 10,
                isAnswered: false,
                highScore: parseInt(localStorage.getItem('quran_highscore') || 0)
            },

            // Ilovani ishga tushirish
            init: function() {
                this.renderJuzGrid();
                document.getElementById('display-highscore').innerText = this.state.highScore + "%";
                
                // Theme check
                if(localStorage.getItem('theme') === 'dark') {
                    document.body.setAttribute('data-theme', 'dark');
                }
            },

            // --- NAVIGATSIYA ---
            navigate: function(screenId) {
                // Barcha seksiyalarni yashirish
                document.querySelectorAll('section').forEach(el => {
                    el.classList.add('hidden');
                    el.classList.remove('active');
                });
                
                // Keraklisini ko'rsatish
                const target = document.getElementById('page-' + screenId);
                target.classList.remove('hidden');
                
                // Kichik animatsiya uchun
                setTimeout(() => target.classList.add('active'), 10);
                window.scrollTo(0,0);
            },

            // --- SOZLAMALAR ---
            setDifficulty: function(level) {
                this.state.difficulty = level;
                // UI yangilash
                ['easy', 'medium', 'hard'].forEach(l => {
                    const btn = document.getElementById('diff-' + l);
                    if (l === level) {
                        btn.classList.add('btn-primary');
                        btn.classList.remove('btn-outline');
                    } else {
                        btn.classList.add('btn-outline');
                        btn.classList.remove('btn-primary');
                    }
                });
            },

            toggleTheme: function() {
                const body = document.body;
                const isDark = body.getAttribute('data-theme') === 'dark';
                const newTheme = isDark ? 'light' : 'dark';
                body.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
            },

            // --- JUZ UI GENERATOR ---
            renderJuzGrid: function() {
                const container = document.getElementById('juz-container');
                container.innerHTML = '';
                for (let i = 1; i <= 30; i++) {
                    const btn = document.createElement('div');
                    btn.className = 'juz-box';
                    btn.innerText = i;
                    btn.onclick = () => this.startJuzTest(i);
                    container.appendChild(btn);
                }
            },

            // --- TEST MANTIQI (LOGIC) ---
            startJuzTest: function(juzNumber) {
                this.prepareQuestions(juzNumber);
            },

            startFullTest: function() {
                this.prepareQuestions('full');
            },

            prepareQuestions: function(filter) {
                let pool = [];

                if (filter === 'full') {
                    pool = [...QUESTION_DB];
                } else {
                    pool = QUESTION_DB.filter(q => q.juz === filter);
                }

                // Daraja bo'yicha filtrlash (ixtiyoriy, agar yetarli savol bo'lsa)
                // Hozirgi DB kichik bo'lgani uchun, agar savol yetmasa, boshqa savollar bilan to'ldiramiz (MIX MODE).
                // Haqiqiy appda faqat tanlangan daraja olinadi.
                
                // Agar savol kam bo'lsa, random savollar qo'shamiz (Foydalanuvchini xafa qilmaslik uchun)
                if (pool.length < this.state.total) {
                    const others = QUESTION_DB.filter(q => !pool.includes(q));
                    pool = pool.concat(others);
                }

                // Randomizatsiya va kesish
                this.state.questions = pool.sort(() => 0.5 - Math.random()).slice(0, this.state.total);
                this.state.currentIndex = 0;
                this.state.score = 0;
                
                this.navigate('quiz');
                this.renderQuestion();
            },

            renderQuestion: function() {
                const q = this.state.questions[this.state.currentIndex];
                this.state.isAnswered = false;

                // UI Update
                document.getElementById('quiz-counter').innerText = `${this.state.currentIndex + 1} / ${this.state.total}`;
                
                // Progress Bar
                const progress = ((this.state.currentIndex) / this.state.total) * 100;
                document.getElementById('quiz-progress').style.width = `${progress}%`;

                // Content
                document.getElementById('question-text').innerText = q.q;
                document.getElementById('ayah-box').innerText = q.a;

                // Reset Panels
                document.getElementById('hikmat-panel').style.display = 'none';
                document.getElementById('btn-next').classList.add('hidden');

                // Options Render
                const optsContainer = document.getElementById('options-box');
                optsContainer.innerHTML = '';

                // Create array of answers with index tracking
                let answers = q.opts.map((txt, idx) => ({ text: txt, isCorrect: idx === q.c }));
                // Shuffle answers
                answers.sort(() => 0.5 - Math.random());

                answers.forEach(ans => {
                    const btn = document.createElement('div');
                    btn.className = 'option-item';
                    btn.innerText = ans.text;
                    btn.onclick = (e) => this.checkAnswer(e.target, ans.isCorrect, answers);
                    optsContainer.appendChild(btn);
                });
            },

            checkAnswer: function(el, isCorrect, allAnswers) {
                if (this.state.isAnswered) return;
                this.state.isAnswered = true;

                // Variantlarni bloklash
                const domOptions = document.querySelectorAll('.option-item');
                domOptions.forEach(opt => opt.style.pointerEvents = 'none');

                if (isCorrect) {
                    el.classList.add('correct');
                    this.state.score++;
                } else {
                    el.classList.add('wrong');
                    // To'g'risini ko'rsatish
                    domOptions.forEach(opt => {
                        const originalText = allAnswers.find(a => a.isCorrect).text;
                        if (opt.innerText === originalText) {
                            opt.classList.add('correct');
                        }
                    });
                }

                // Hikmat Ko'rsatish
                const randomHikmat = HIKMATLAR[Math.floor(Math.random() * HIKMATLAR.length)];
                document.getElementById('hikmat-content').innerText = randomHikmat;
                document.getElementById('hikmat-panel').style.display = 'block';

                // Keyingi tugmasi
                const btnNext = document.getElementById('btn-next');
                btnNext.classList.remove('hidden');
                btnNext.innerText = (this.state.currentIndex === this.state.total - 1) ? "NATIJANI KO'RISH" : "KEYINGI SAVOL ‚Üí";
                
                // Update Progress visual to full for current step
                document.getElementById('quiz-progress').style.width = `${((this.state.currentIndex + 1) / this.state.total) * 100}%`;
            },

            nextQuestion: function() {
                if (this.state.currentIndex < this.state.total - 1) {
                    this.state.currentIndex++;
                    this.renderQuestion();
                } else {
                    this.finishQuiz();
                }
            },

            finishQuiz: function() {
                const score = this.state.score;
                const total = this.state.total;
                const percent = Math.round((score / total) * 100);

                // Save High Score
                if (percent > this.state.highScore) {
                    this.state.highScore = percent;
                    localStorage.setItem('quran_highscore', percent);
                    document.getElementById('display-highscore').innerText = percent + "%";
                }

                // Result Screen Content
                document.getElementById('res-score').innerText = percent + "%";
                document.getElementById('res-correct').innerText = score;
                document.getElementById('res-wrong').innerText = total - score;

                // Message Logic
                let msg = "";
                if (percent === 100) msg = "MashaAlloh! Mukammal natija. Hifzingiz mustahkam.";
                else if (percent >= 80) msg = "Barakalla! Juda yaxshi natija. Kichik xatolarni tuzating.";
                else if (percent >= 50) msg = "Yomon emas, lekin takrorlashga muhtojsiz.";
                else msg = "G'ayrat qiling! Ko'proq o'qish va takrorlash kerak.";
                
                document.getElementById('res-msg').innerText = msg;
                this.navigate('result');
            }
        };

        // Ilova yuklanganda ishga tushirish
        window.onload = function() {
            App.init();
        };

    </script>
</body>
</html>


